# 開発ガイド

villa_gusku_web への貢献ありがとうございます。このガイドでは、Issue 作成から PR までの開発フローと基準をまとめます。

## 目次

- [Issue 作成ガイドライン](#issue-作成ガイドライン)
- [開発環境セットアップ](#開発環境セットアップ)
- [Git ワークフロー](#git-ワークフロー)
- [コミット規約](#コミット規約)
- [PR 作成フロー](#pr-作成フロー)
- [コーディング規約](#コーディング規約)
- [テスト方針](#テスト方針)
- [コードレビュー基準](#コードレビュー基準)
- [トラブルシューティング](#トラブルシューティング)

---

## Issue 作成ガイドライン

新機能開発や修正の前に、必ず GitHub Issue を作成してください。Issue は設計書であり、レビューの基準です。

### Issue テンプレート

```markdown
## 📋 概要

[1-2文で変更内容を簡潔に説明]

関連issue: [関連するIssue番号があれば記載]

---

## 🎯 背景・課題

### 現状の問題
- [現在どのような問題があるか]
- [なぜこの変更が必要なのか]

### 課題
- [具体的な課題1]
- [具体的な課題2]
- [具体的な課題3]

---

## 🎯 目的・ゴール

### 主目的
[この変更で達成したいこと]

### 副次的目標
- [追加で達成したいこと1]
- [追加で達成したいこと2]

---

## 📖 要件定義

### 機能要件

#### FR-1: [機能名1]
- [詳細な要件説明]
- [実装内容]

#### FR-2: [機能名2]
- [詳細な要件説明]
- [実装内容]

### 非機能要件

#### NFR-1: パフォーマンス
- [パフォーマンス要件]

#### NFR-2: セキュリティ
- [セキュリティ要件]

#### NFR-3: 保守性
- [保守性要件]

---

## 🛠️ 技術仕様

### アーキテクチャ

[構成図やページフローなど]

### 実装詳細

[具体的な実装方法、コード例など]

---

## ✅ 受け入れ基準

### Must Have
- [ ] [必須要件1]
- [ ] [必須要件2]

### Should Have
- [ ] [推奨要件1]
- [ ] [推奨要件2]

### Nice to Have
- [ ] [オプション要件1]
- [ ] [オプション要件2]

---

## ⏱️ 工数見積

### タスク分解

| タスク | 内容 | 見積工数 |
|--------|------|----------|
| 設計 | [設計内容] | X.Xh |
| 実装 | [実装内容] | X.Xh |
| テスト | [テスト内容] | X.Xh |
| ドキュメント更新 | [ドキュメント更新内容] | X.Xh |

合計見積: X時間（X営業日）

---

## 🧪 テスト計画

### テストケース

#### TC-1: [テストケース名1]
- 手順:
  1. [手順1]
  2. [手順2]
- 期待結果: [期待される結果]

#### TC-2: [テストケース名2]
- 手順:
  1. [手順1]
  2. [手順2]
- 期待結果: [期待される結果]

---

## 📈 次のステップ

[この機能完了後の展開、将来の拡張など]

---

## 📚 関連資料

- [関連ドキュメント、外部リンクなど]

---

## ✅ Definition of Done

- [ ] [完了条件1]
- [ ] [完了条件2]
- [ ] すべてのテストケース合格
- [ ] ドキュメント更新完了
- [ ] コードレビュー承認
- [ ] 本番環境デプロイ・検証完了

---

工数見積: X時間（X営業日）
優先度: High/Medium/Low
難易度: High/Medium/Low
依存関係: [依存するIssueや前提条件]
```

### 工数見積ガイドライン

#### タスク分解の基本

| タスク | 内容 | 一般的な割合 |
|--------|------|------------|
| **設計** | 仕様整理、ページ構成検討 | 15-20% |
| **実装** | HTML/CSS/JS作業、画像調整 | 40-50% |
| **テスト** | 目視確認、表示崩れチェック | 20-25% |
| **ドキュメント更新** | README、CONTRIBUTING等の更新 | 10-15% |

#### 見積単位

- **時間単位**: 0.5時間刻み
- **営業日換算**: 1営業日 = 8時間
- **最小単位**: 0.5時間
- **最大単位**: 16時間（2営業日）

💡 **推奨**: 16時間を超える場合は、タスクを分割してください。

#### 確実性レベル

| レベル | 説明 | バッファ | 例 |
|--------|------|---------|-----|
| **高確実性** | 過去に類似対応あり | +10% | 文言修正、軽微なUI調整 |
| **中確実性** | 一般的な実装パターン | +25% | 新セクション追加、ギャラリー更新 |
| **低確実性** | 新しい表現や複雑な構成 | +50% | 大幅なレイアウト変更 |

#### 見積例

##### 難易度: Low（簡単な修正・追加）
- 例: 文言修正、軽微なデザイン調整
- 見積: 2-4時間（0.25-0.5営業日）
- 内訳:
  - 設計: 0.5h
  - 実装: 1.5h
  - テスト: 0.5h
  - ドキュメント: 0.5h

##### 難易度: Medium（通常の機能開発）
- 例: 新セクション追加、ギャラリー構成変更
- 見積: 8-16時間（1-2営業日）
- 内訳:
  - 設計: 2h
  - 実装: 6h
  - テスト: 3h
  - ドキュメント: 1h

##### 難易度: High（複雑な変更）
- 例: 大規模なレイアウト変更、複数ページ化
- 見積: 24-40時間（3-5営業日）
- 内訳:
  - 設計: 6h
  - 実装: 18h
  - テスト: 10h
  - ドキュメント: 2h

#### バッファの考え方

**基本ルール**: 見積工数に確実性レベルに応じたバッファを追加

例: 実装8時間、確実性レベル「中」の場合
```
基本見積: 8h
バッファ: 8h × 25% = 2h
最終見積: 10h
```

💡 **推奨**: 全体に+25%のバッファを追加することで、予期せぬ問題に対応できます。

#### 優先度と難易度の定義

| 優先度 | 説明 | 対応期限の目安 |
|--------|------|---------------|
| **High** | ビジネスクリティカル、ブロッカー | 即座に着手 |
| **Medium** | 重要だが緊急ではない | 1-2週間以内 |
| **Low** | あると便利、改善項目 | 時間があるとき |

| 難易度 | 説明 | 見積工数目安 |
|--------|------|-------------|
| **Low** | 簡単な修正、既知のパターン | 2-4時間 |
| **Medium** | 通常の変更、一般的な複雑さ | 8-16時間 |
| **High** | 複雑な変更、大規模改修 | 24時間以上 |

---

## 開発環境セットアップ

### 必要なツール

| ツール | 必須/任意 | 用途 |
|--------|----------|------|
| Git | 必須 | バージョン管理 |
| 任意の静的サーバ | 任意 | ローカルプレビュー |

### セットアップ手順

```bash
# リポジトリをクローン
git clone https://github.com/zomians/villa_gusku_web.git
cd villa_gusku_web
```

### ローカルプレビュー

静的サイトのため、ブラウザで直接開いて確認できます。相対パスやスクリプト挙動の確認が必要な場合は、ローカルサーバの利用を推奨します。

例:
```bash
# Python がある場合
python3 -m http.server 8000

# Node.js を使う場合（任意）
npx serve .
```

---

## Git ワークフロー

このプロジェクトは GitHub Flow を採用します。

### 🚨 重要な原則：ブランチを作ってから作業する

**作業を開始する前に、必ず以下の手順を守ってください：**

#### ❌ BAD: main ブランチで直接作業

```bash
# これは絶対にやってはいけません！
git checkout main
# main ブランチで直接ファイルを編集...
git add .
git commit -m "fix: 修正"
git push origin main  # ❌ main へ直接プッシュ
```

#### ✅ GOOD: 正しい手順

```bash
# 1. Issue を作成（例: Issue #42 を作成）

# 2. main ブランチを最新化
git checkout main
git pull origin main

# 3. 作業用ブランチを作成
git checkout -b feature/42-new-section

# 4. 実装作業
# ファイルを編集...

# 5. コミット
git add .
git commit -m "feat: セクションを追加 (issue#42)"

# 6. プッシュ
git push origin feature/42-new-section

# 7. GitHub で PR を作成
```

#### ⚠️ 間違いに気づいた場合

**main ブランチで作業してしまった場合：**

```bash
# 方法1: 変更をまだコミットしていない場合
git stash                              # 変更を一時保存
git checkout -b feature/XX-fix         # 正しいブランチを作成
git stash pop                          # 変更を適用

# 方法2: すでにコミットしてしまった場合（プッシュ前）
git branch feature/XX-fix              # 現在の状態で新ブランチ作成
git reset --hard origin/main           # main を元に戻す
git checkout feature/XX-fix            # 新ブランチに切り替え
```

**main ブランチにプッシュしてしまった場合：**

すぐにチームに報告してください。revert が必要になる場合があります。

#### なぜこれが重要か？

1. **main ブランチの保護**
   - main は常に安定した状態を保つ必要があります
   - CI/CDで自動デプロイされる可能性があります

2. **変更の追跡**
   - PR を通じてコードレビューが可能になります
   - 変更履歴が明確になります

3. **ロールバック**
   - 問題があった場合、簡単に元に戻せます
   - main ブランチは影響を受けません

4. **並行作業**
   - 複数の機能を同時に開発できます
   - 他のメンバーの作業と競合しません

### ブランチ命名規則

**フォーマット:**
```
<type>/<issue番号>-<機能名>
```

**Type 一覧:**

| Type | 用途 | 例 |
|------|------|-----|
| `feature/` | 新機能の追加 | `feature/57-add-gallery` |
| `bugfix/` | バグ修正 | `bugfix/58-fix-layout` |
| `hotfix/` | 緊急修正（本番環境の問題） | `hotfix/59-critical-fix` |
| `refactor/` | リファクタリング | `refactor/60-cleanup-css` |
| `docs/` | ドキュメント更新 | `docs/61-update-contributing` |

**良い例:**
```bash
feature/42-add-gallery
bugfix/43-fix-hero-image
docs/44-update-contributing
```

**悪い例:**
```bash
fix-bug              # ❌ Issue番号がない
feature-new          # ❌ 具体的な機能名がない
update               # ❌ typeとIssue番号がない
```

---

## コミット規約

[Conventional Commits](https://www.conventionalcommits.org/) に準拠します。

**フォーマット:**

```
<type>(<scope>): <subject> (issue#<番号>)

<body>（任意）
<footer>（任意）
```

**Type 一覧:**

| Type | 用途 | 例 |
|------|------|-----|
| `feat` | 新機能の追加 | `feat(app): ギャラリーを追加` |
| `fix` | バグ修正 | `fix(layout): モバイル崩れを修正` |
| `docs` | ドキュメントのみの変更 | `docs: CONTRIBUTING.mdを更新` |
| `refactor` | リファクタリング（機能変更なし） | `refactor(css): クラス整理` |
| `test` | テストの追加・修正 | `test: 表示確認項目を追加` |
| `chore` | ビルド・ツール・依存関係の変更 | `chore: 画像最適化` |
| `perf` | パフォーマンス改善 | `perf(images): 画像を圧縮` |
| `style` | コードスタイルの変更（機能に影響なし） | `style: インデント修正` |

**Scope（任意）:**

| Scope | 説明 |
|-------|------|
| `app` | サイト全般 |
| `layout` | レイアウト |
| `content` | 文言・情報 |
| `assets` | 画像・フォントなど |

**良い例:**

```bash
feat(app): ヒーローセクションを追加 (issue#12)
fix(layout): モバイル崩れを修正 (issue#34)
docs: CONTRIBUTING.mdを追加 (issue#1)
refactor(css): セレクタを整理 (issue#45)
```

**悪い例:**

```bash
update code          # ❌ typeがない、issue番号がない
fix bug              # ❌ 具体的な内容がない、issue番号がない
feat: 機能追加       # ❌ 具体的な内容がない、issue番号がない
```

### ❌ 禁止事項：AI生成メッセージの追加

**コミットメッセージには、AI（Claude Code、GitHub Copilot、Cursorなど）が生成したことを示すメッセージを追加しないでください。**

**禁止例:**

```bash
# ❌ これらのメッセージを追加してはいけません
feat(app): 新機能を追加 (issue#12)

🤖 Generated with Claude Code
Co-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>

# ❌ これも禁止
fix(layout): レイアウト修正 (issue#34)

Generated by GitHub Copilot
```

**理由:**
- コミット履歴はコードの変更内容を追跡するものであり、使用したツールを記録する場所ではありません
- 将来的にツールの記載が不要になった場合、履歴の一貫性が失われます
- AIツールはあくまで開発支援ツールであり、成果物の品質は開発者の責任です

---

## PR 作成フロー

### 1. 実装とコミット

```bash
git add .
git commit -m "feat(app): 〇〇を実装 (issue#12)"
git push origin feature/12-xxx
```

### 2. PR テンプレート

```markdown
## 概要

[変更の概要を1-2文で説明]

## 変更内容

- [主要な変更点1]
- [主要な変更点2]

## テスト方法

[ローカルプレビューや確認手順を記載]

## チェックリスト

- [ ] 表示確認（PC/モバイル）
- [ ] 画像・リンクの表示/動作確認
- [ ] ドキュメント更新

Closes #XX

```

### ❌ 禁止事項：AI生成メッセージの追加

**PRの説明文には、AI（Claude Code、GitHub Copilot、Cursorなど）が生成したことを示すメッセージを追加しないでください。**

**禁止例:**

```markdown
Closes #12

🤖 Generated with Claude Code  # ❌
Co-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>  # ❌
Generated by GitHub Copilot  # ❌
```

**理由:**
- PRは変更内容とその理由を説明するものであり、使用したツールを宣伝する場所ではありません
- プロジェクトの履歴として残る情報は、技術的な内容に限定すべきです
- AIツールの利用は個人の選択であり、プロジェクト全体に影響を与えるべきではありません

### 3. マージ戦略：Squash and Merge 推奨

このプロジェクトでは **Squash and Merge** を推奨します。

#### メリット

1. **綺麗な履歴**
   - main ブランチに `1 PR = 1 コミット` として記録
   - WIPコミットや修正コミットが残らない
   - 履歴が読みやすく、理解しやすい

2. **Conventional Commits との相性**
   - PR タイトルがそのままコミットメッセージになる
   - 統一されたフォーマットが維持される

3. **Revert が簡単**
   - 機能単位で1コミットなので、revert が容易
   - 影響範囲が明確

#### マージ戦略の比較

| 戦略 | メリット | デメリット | 推奨度 |
|------|---------|-----------|-------|
| **Squash and Merge** | 綺麗な履歴、1PR=1コミット | 個別コミットの履歴が消える | ⭐⭐⭐ 推奨 |
| Merge commit | 完全な履歴保持 | マージコミットで履歴が複雑 | ⭐ 特殊なケースのみ |
| Rebase and merge | リニアな履歴 | コンフリクト解決が複雑 | ⭐⭐ 小規模変更 |

#### 使い方

GitHub の PR 画面で「Squash and merge」を選択してください。

```
Squash and merge ▼
```

デフォルトで Squash and Merge が選択されるように設定することを推奨します。

---

## コーディング規約

### HTML

- 見出し階層を守る（`h1` → `h2` → `h3`）
- 画像には `alt` を必ず付ける
- セマンティックタグ（`header`/`main`/`section`/`footer`）を使用する

### CSS

- 目的が分かるクラス名を付ける
- 可能な限りコンポーネント単位で整理する
- 影響範囲の広い変更は最小限に抑える

### JavaScript（使用する場合）

- できるだけシンプルに保つ
- グローバル汚染を避ける
- 依存を増やす前に相談する

---

## テスト方針

- 変更内容に応じて**目視確認**を必須とする
- PC/モバイルでの表示崩れを確認する
- 画像・リンクの表示/動作を確認する

---

## コードレビュー基準

### 基本チェック項目

- [ ] Issue の要件を満たしているか
- [ ] レイアウトや余白が崩れていないか
- [ ] 画像の容量・サイズが適切か
- [ ] 文言や情報が正確か
- [ ] アクセシビリティ（alt、コントラスト）が確保されているか

---

## トラブルシューティング

### 画像が表示されない

- パスが正しいか（相対パス）を確認
- ファイル名の大小文字が一致しているかを確認

### スタイルが反映されない

- CSS ファイルの読み込みパスを確認
- ブラウザのキャッシュをクリアして再読み込み

### ローカルサーバが起動できない

- Python/Node が利用可能か確認
- 別の簡易サーバやブラウザ直接表示で代替

---

## 質問・サポート

- Issue を作成して相談してください。
